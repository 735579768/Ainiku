<div class="comments" style="width:800px; margin:0px auto;">
<style>
#comments-list a,
#comments-list{ color:#000; font-size:14px;}
#comments-list dt a{ text-decoration:none;}
#comments-list dt a:hover{ text-decoration:underline; color:#f00;}
#comments-list .line{ display:block; height:0px; border-bottom:dashed 1px #ccc;}
#comments-list dl{ margin:10px 0px;}
#comments-list dl dl{border: dashed 1px #ccc;margin-left: 20px;}
#comments-list dl dl:hover{    background: #F7F7F7;}
#comments-list dl dl dt{ background:none;}
#comments-list dt{ padding:0px 10px; height:30px;line-height: 30px;background-color: #F7F7F7;}
#comments-list dt .huifu{ color:#8E8E8E; text-decoration:none;    margin-left: 10px;}
#comments-list dt .ptime{ color:#8E8E8E;    font-size: 12px;}
#comments-list dd{ padding:10px;word-break: break-all; color:#888;}
#comments-list a.btn{ color:#fff;}
#comments-list dd #commentsform{ margin-top:20px;}
</style>
<div id="comments-form">
<form method="post" class="form-group-h" id="commentsform" action="{:UP('Comments/add')}">
  <div class="form-group">
    <label class="form-label"for="exampleInputEmail1">名字</label>
    <input type="text" name="name" id="comments-name" class="form-control input-large"  placeholder="输入您的名字">
  </div>
    <div class="form-group">
    <label class="form-label"for="exampleInputEmail1">邮箱</label>
    <input type="text" name="email" class="form-control input-large"  placeholder="输入你的邮箱">
  </div>
     <div class="form-group">
    <label class="form-label"for="exampleInputEmail1">网站地址</label>
    <input type="text" name="url" class="form-control input-large"  placeholder="输入你的网站地址">
  </div>
    <div class="form-group">
    <label class="form-label"for="exampleInputEmail1">内容</label>
    <textarea name="content" id="comments-content" class="form-control input-large" placeholder="输入内容"></textarea>
  </div>
      <div class="form-group">
    <label class="form-label"for="exampleInputEmail1">验证码</label>
    <input type="text" name="verify" id="verifyimg" class="form-control input-middle" placeholder="输入验证码">
<div id="verify" style="display:inline-block;">
    <img style="cursor:pointer; vertical-align:middle;" class="verifyimg reloadverify"  id="verifyimg" alt="点击切换" onclick="this.src='{:U('Public/verify')}?random='+Math.random();" src="{:U('public/verify')}">
    </div>
  </div>
    <div class="form-group center">
    <input name="arc_id" type="hidden" value="{$info.article_id}" />
    <input id="commentpid" name="pid" type="hidden" value="0" />
    <a href="javascript:;" id="addcomments" class="btn btn-large">提交评论</a>
    <a href="javascript:;" style="display:none;" class="btn btn-large" id="cancelbtn" onClick="cancelhuifu(this);">取消回复</a>
  </div>
</form>
</div>
<div id="comments-list" class="comments-list">

</div>
<script>
$(function(){
window.cancelhuifu=function(obj){
	$('#comments-form').append($(obj).parents('form'));
	$('#commentpid').val(0);
	$('#cancelbtn').hide();
	};
window.huifuclick=function(obj,pid,id){
	$('#cancelbtn').show();
	pid=pid?pid:id;
	$('#commentpid').val(pid);
	var dobj=$(obj).parents('dt').next();
	dobj.append($('#commentsform'));
	return false;
	};
$('#addcomments').click(function(e) {
           var formobj = $(this).parents("form");
            formobj.submit(function(e) {
                return false;
            });
			if(!(/^[a-zA-Z0-9]{4}$/.test($('#verifyimg').val()))){ank.msg('请填入正确的验证码!');return false;}
			if(/\s*/.test($('#comments-content').val())){ank.msg('请填入内容!');return false;}
			if(!(/^.{2,5}$/.test($('#comments-name').val()))){ank.msg('请填入正确的名字!');return false;}
           var uri = formobj.attr("action");
            postdata = formobj.serialize();
           // $("body").append('<div id="liuyanklbg" class="bg">');
		   $('#addcomments').html('正在提交...');
            $.ajax({
                url:uri,
                type:"POST",
                datatype:"JSON",
                data:postdata,
                success:function(da) {
					if(da.status=='1'){
							ank.msg(da.info.msg);
							var len=formobj.parents('#comments-list').length;
							if(len===1){
							formobj.before(da.info.content);
							cancelhuifu();
							}else{
							$('#comments-list').prepend(da.info.content);
								}
						}else{
						ank.msg(da.info);
							}
					$('#addcomments').html('提交评论');
					//	$('#liuyanklbg').remove();
                }
            });
});
//window.load2huifu=function(){};
ank.loadhtml('{:UP('Comments/ajaxlist')}',{},$('#comments-list'),'POST');	
});
function  _after_func(){
	$('#verifyimg').click();
	}
</script>
</div>