$(function(){window.am={version:"1.0",changeVerify:function(){var t=document.getElementById("verifyimg");t&&(t.src=t.src.replace(/\&r=.*/,"")+"&r="+Math.random())},okAction:function(t){layer.confirm("确认此操作?",{btn:["确认","取消"]},function(e){layer.close(e),$.get(t,function(t){ank.msg(t)})},function(){})},init:function(){$(".ajax-post").bind("click",function(){return $("#yzerr").length>0?(ank.msg("请按格式填写!"),!1):void am.ajaxForm($(this))}),$(".ajax-href").bind("click",function(){return am.ajaxHref($(this))}),$(".ajax-href-del").bind("click",function(){var t=$(this);return layer.confirm("确认此操作吗?",{btn:["确认","取消"]},function(e){return layer.close(e),am.ajaxHref(t)}),!1}),$(".ajax-list-del").bind("click",function(){var t=$(this);return layer.confirm("确认此操作吗?",{btn:["确认","取消"]},function(e){layer.close(e);var a=t.attr("href");$.ajax({type:"POST",url:a,success:function(e){"1"==e.status&&t.parent().parent().remove(),ank.msg(e.info)},dataType:"JSON"})}),!1}),$(".ajax-blur").bind("change",function(){var t=$(this).attr("data-id"),e=$(this).attr("data-table"),a=$(this).attr("data-field"),n=$(this).val();$.ajax({type:"POST",url:ainiku.updatefield,data:{id:t,table:e,field:a,value:n},success:function(t){ank.msg(t)}})}),$(".yn").each(function(t,e){$(this).parent().css("text-align","center");var a=parseInt($(this).attr("data-value"));1===a?$(this).addClass("y"):$(this).addClass("n"),$(this).click(function(t){var e=$(this),a=parseInt($(this).attr("data-value")),n=$(this).attr("data-table"),i=$(this).attr("data-field"),r=$(this).attr("data-id"),o=function(){e.hasClass("y")?(e.attr("data-value",0),e.removeClass("y"),e.addClass("n")):(e.attr("data-value",1),e.removeClass("n"),e.addClass("y"))};a=a?0:1,""!==a&&""!==n&&""!==i&&""!==r&&(o(),$.ajax({type:"POST",data:{id:r,table:n,field:i,value:a},url:ainiku.updatefield,success:function(t){ank.msg(t)}}))})}),$(".mainnav li a").click(function(t){$(".mainnav li a").removeClass("hover"),$(this).addClass("hover")}),$(".downmenu").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()});var t=$("#west"),e=$("#closewest");e.click(function(e){var a=$(this);"180px"==a.css("left")?(a.animate({left:"-0px"},200,function(){a.addClass("open")}),t.animate({overflow:"hidden",left:"-180px"},200),$("body").animate({paddingLeft:"0px"},200),am.writeCookie("leftside",0)):(a.animate({left:"180px"},200,function(){a.removeClass("open")}),t.animate({overflow:"hidden",left:"0px",overflowY:"scroll"},200),$("body").animate({paddingLeft:"180px"},200),am.writeCookie("leftside",1))}),"0"===am.readCookie("leftside")&&(t.css({overflow:"hidden",padding:"10px 0px 50px 0px",left:"-180px"}),$("body").css({paddingLeft:"0"}),e.css("left","0px"),e.addClass("open")),$("#mainnav a").each(function(t){var e=window.location.href,e=e.replace(/(.+?)\.(.+?)\//,"/"),a=$(this).attr("href");a==e&&$(this).addClass("hover")}),$("#mainnav li a").click(function(e){$("#loadingimg").show();var a=t,n=(a.html(),$(this).attr("data-url"));return $.ajax({type:"POST",url:ainiku.getmenu,data:{url:n},success:function(e){$("#loadingimg").hide(),"1"==e.status?t.html(e.info):ank.msg(e.info)}}),!1}),$(".check-all").click(function(t){$(this).is(":checked")?$(".check-item").prop("checked",!0).change():$(".check-item").prop("checked",!1).change()}),$(".popupthumb").hover(function(){var t=$(this),e=t.find("img").length;if(0==e){var a=$(this).find(".imgbox").attr("_src");$(this).find(".wrapimg").append('<img src="'+a+'" width="" height="" />')}var n=t.offset().top,i=$(window).height(),r=$(this).find(".imgbox").height();r>i-n-20&&n>=i-n?$(this).find(".imgbox").css({top:"-"+r+"px"}):$(this).find(".imgbox").css({top:"35px"}),$(this).find(".imgbox").show()},function(){$(this).find(".imgbox").hide()}),$(".klbatch").bind("click",function(){return $(this).addClass("disabled"),obj=$(this),url=obj.attr("href"),idstr="",$("input.check-item:checked").each(function(t,e){""==idstr?idstr=$(this).val():idstr+=","+$(this).val()}),idstr=idstr.replace(/\s+/g,""),""==idstr?(ank.msg("请选择后再操作"),$(this).removeClass("disabled"),!1):confirm("确定要此操作吗?")?($.ajax({type:"GET",url:url,data:{id:idstr},success:function(t){ank.msg(t,function(t){"1"==t.status&&window.location.reload()})},dataType:"JSON"}),!1):!1}),$(".btn-search").click(function(t){$(this).parents("form").submit()}),$(".autosubmit").find("input").keyup(function(t){if(13===t.keyCode){var e=$(this).parents("form").find(".ajax-post");e.length>0?e.click():$(this).parents("form").submit()}}),$("#nav-bar a").each(function(t,e){var a=window.location.pathname,n=$(this).attr("href");a===n&&$(this).parent().addClass("on")}),$("#west").length>0&&this.bindLeftMenu()},bindLeftMenu:function(){if($(".menu .mt a").click(function(t){var e=$(this).find("i");e.hasClass("menuopenico")?(e.removeClass("menuopenico"),e.addClass("menucloseico"),e.parents("dl").find("dd").hide()):($(this).parents("#west").find("i.menuopenico").click(),e.removeClass("menucloseico"),e.addClass("menuopenico"),e.parents("dl").find("dd").show())}),$(".menu .mitem  a").click(function(t){$(".menu .mitem  a").removeClass("hover"),$(this).addClass("hover");var e=$(this).attr("href"),a=$(this).text();return addtabclose(a,e),!1}),$(".menu .mt a").click(),am.hasmenu=!1,$(".menu a").each(function(t,e){var a=window.location.href;a=a.replace(/(.*?)\.(.*?)\//,"/"),a=a.replace("&mainmenu=true","");var n=$(this).attr("href");a==n&&(am.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))}),!am.hasmenu){var t=window.location.href;t=t.replace(/(.*?)\.(.*?)\//,"/"),t=t.replace(".html","");$(".menu a").each(function(e,a){var n=t.split("/"),i=$(this).attr("href");i=i.replace(".html","");var r=i.split("/");n.length>r.length?n=n.slice(0,r.length):r=r.slice(0,n.length),n.join("/")==r.join("/")&&(window.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))})}if(am.hasmenu||$(".menu a").each(function(t,e){var a=document.referrer;a=a.replace(/(.*?)\.(.*?)\//,"/");var n=$(this).attr("href");a===n&&(window.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))}),!am.hasmenu){var e=$(".menu a[href='"+ainiku.defaultmenu+"']");e.length>0?(e.addClass("hover"),e.parents(".menu").find("dt a").click()):$(".menu dt a").eq(0).click()}},bindDel:function(){$(".imgblock  .btn-danger").unbind("click"),$(".imgblock  .btn-danger").click(function(t){var e=$(this).attr("dataid");$.get(ainiku.delimg,{id:e});var a=$(this).parent().parent().prev().val();return""!=a&&(a=a.replace(/\s+/g,""),a=a.replace(e+"|",""),a=a.replace("|"+e,""),a=a.replace(e,""),a=a.replace("||","|"),$(this).parent().parent().prev().val(a),$(this).parent().remove()),!1})},delEditorImg:function(t,e){t===e||$.ajax({type:"POST",url:ainiku.deleditorimg,data:{s:t,d:e}})},bindDelAttach:function(){$(".upload-pre-file .btn-danger").unbind("click"),$(".upload-pre-file .btn-danger").click(function(t){var e=$(this).attr("dataid");$.get(ainiku.delattach,{id:e}),$(this).parent().parent().prev().val(""),$(this).parent().remove()})},setPosition:function(t,e,a,n,i){var r=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(ainiku.setposition,{table:t,id:e,field:a,value:n},function(t){layer.close(r),layer.open({shade:0,title:"修改标记",type:1,content:t.info,area:["330px"],btn:["保存","取消"],yes:function(t,e){var a=$("#positionform");$.ajax({type:"POST",url:a.attr("action"),data:a.serialize(),success:function(t){var e=$(i).children();1==t.status&&(e.eq(0).val(t.info[1]),e.eq(1).html(t.info[0])),ank.msg("操作成功!")}}),layer.close(t)},cancel:function(t,e){layer.close(t)}})})},ajaxForm:function(thisobj,callback){thisobj=$(thisobj),"undefined"!=typeof arguments[2]&&(reloadbool=arguments[2]),"undefined"!=typeof arguments[1]&&(msgtime=arguments[1]);try{"function"==typeof _before_func&&_before_func();var thisobj,obj,a,url;if(a="",formobj=thisobj.parents("form"),!formobj)return!1;formobj.submit(function(t){return!1});var url=formobj.attr("action");postdata=formobj.serialize(),a="{"+a+"}",b=eval("("+a+")");var lindex=parent.layer.load(1,{shade:!1});$.ajax({url:url,type:"POST",datatype:"JSON",data:postdata,success:function(t){parent.layer.close(lindex),ank.msg(t,function(){"function"==typeof _after_func&&_after_func(t),"function"==typeof callback&&callback(t)})}})}catch(e){alert(e.name+": "+e.message)}},ajaxHref:function(t,e){t=$(t),"undefined"!=typeof arguments[2]&&(reloadbool=arguments[2]),"undefined"!=typeof arguments[1]&&(msgtime=arguments[1]),url=t.attr("href"),"undefined"==typeof url&&(url=t.attr("url"));var a=parent.layer.load(1,{shade:!1});return $.ajax({type:"POST",url:url,success:function(t){parent.layer.close(a),ank.msg(t,function(){"function"==typeof _after_func&&_after_func(t),"function"==typeof e&&e(t)})},dataType:"JSON"}),!1},writeCookie:function(t,e,a){var n="";null!=a&&(n=new Date((new Date).getTime()+36e5*a),n="; expires="+n.toGMTString()),document.cookie=t+"="+encodeURI(e)+n},readCookie:function(t){var e="",a=t+"=";return document.cookie.length>0&&(offset=document.cookie.indexOf(a),-1!=offset&&(offset+=a.length,end=document.cookie.indexOf(";",offset),-1==end&&(end=document.cookie.length),e=decodeURI(document.cookie.substring(offset,end)))),e},submitArticle:function(t){var e=$(t).parents("form");e.submit(function(t){return!1});var a=e.attr("action"),n=e.serialize(),i=parent.layer.load(1,{shade:!1});$.ajax({url:a,type:"POST",datatype:"JSON",data:n,success:function(t){parent.layer.close(i),ank.msg(t.info);var e=$('input[name="article_id"]').val();""==e&&$('input[name="article_id"]').val(t.article_id)}})},saveDraftbox:function(t,e){am.draftboxtimeid&&clearInterval(am.draftboxtimeid);var a=t,n=$("#submitbtn"),i=n.html();if(1==a){var r=e,o=r;am.draftboxtimeid=setInterval(function(){var t=$('input[name="status"]:checked').val();$('input[name="article_id"]').val();if("2"==t){var e=$('input[name="title"]').val();""!=e&&($("#submitbtn").html("保存草稿("+o+")"),o--<=0&&(o=r,am.submitArticle()))}else o=r,2!=t?n.html("确定更新"):n.html(i)},1e3)}},updatePwd:function(t){var e=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(t,function(t){ank.open({title:"修改密码",type:1,content:t,area:["300px","350px"]}),layer.close(e)})},modPwd:function(t){var e=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(t,function(t){ank.open({title:"修改密码",type:1,content:t,area:["300px","350px"]}),layer.close(e)})},autoHeight:function(t){var e=$(t);e.height(t.scrollHeight)}},window.rightMenu={currentTab:null,init:function(){$("#youmenu").hover(function(){$("#youmenu").show()},function(){$("#youmenu").hide()}),$(".chrome-tab").bind("contextmenu",function(){$("#nav-block .chrome-tab").removeClass("currenttab"),$(this).addClass("currenttab"),rightMenu.currentTab=$(this);try{window.event&&(t=window.event),$("#youmenu").css({left:t.clientX-5,top:t.clientY-5}),$("#youmenu").show()}catch(t){}return!1})},closeTab:function(){this.currentTab&&this.currentTab.find(".close").click(),$("#youmenu").hide()},closeOtherTab:function(){$("#nav-block .chrome-tab").not(".currenttab").find(".close").click(),$("#youmenu").hide()}},am.init(),rightMenu.init()});