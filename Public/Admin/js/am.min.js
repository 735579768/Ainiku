$(function(){window.am={version:"1.0",changeVerify:function(){var e=document.getElementById("verifyimg");e&&(e.src=e.src.replace(/\&r=.*/,"")+"&r="+Math.random())},okAction:function(e){layer.confirm("确认此操作?",{btn:["确认","取消"]},function(t){layer.close(t),$.get(e,function(e){ank.msg(e)})},function(){})},init:function(){$(".ajax-post").bind("click",function(){return $("#yzerr").length>0?(ank.msg("请按格式填写!"),!1):void am.ajaxForm($(this))}),$(".ajax-href").bind("click",function(){return am.ajaxHref($(this))}),$(".ajax-href-del").bind("click",function(){var e=$(this);return layer.confirm("确认此操作吗?",{btn:["确认","取消"]},function(t){return layer.close(t),am.ajaxHref(e)}),!1}),$(".ajax-list-del").bind("click",function(){var e=$(this);return layer.confirm("确认此操作吗?",{btn:["确认","取消"]},function(t){layer.close(t);var a=e.attr("href");$.ajax({type:"POST",url:a,success:function(t){"1"==t.status&&e.parent().parent().remove(),ank.msg(t.info)},dataType:"JSON"})}),!1}),$(".ajax-blur").bind("change",function(){var e=$(this).attr("data-id"),t=$(this).attr("data-table"),a=$(this).attr("data-field"),n=$(this).val();$.ajax({type:"POST",url:ainiku.updatefield,data:{id:e,table:t,field:a,value:n},success:function(e){ank.msg(e)}})}),$(".yn").each(function(e,t){$(this).parent().css("text-align","center");var a=parseInt($(this).attr("data-value"));1===a?$(this).addClass("y"):$(this).addClass("n"),$(this).click(function(e){var t=$(this),a=parseInt($(this).attr("data-value")),n=$(this).attr("data-table"),i=$(this).attr("data-field"),r=$(this).attr("data-id"),o=function(){t.hasClass("y")?(t.attr("data-value",0),t.removeClass("y"),t.addClass("n")):(t.attr("data-value",1),t.removeClass("n"),t.addClass("y"))};a=a?0:1,""!==a&&""!==n&&""!==i&&""!==r&&(o(),$.ajax({type:"POST",data:{id:r,table:n,field:i,value:a},url:ainiku.updatefield,success:function(e){ank.msg(e)}}))})}),$(".mainnav li a").click(function(e){$(".mainnav li a").removeClass("hover"),$(this).addClass("hover")}),$(".downmenu").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()});var e=$("#west"),t=$("#closewest");t.click(function(t){var a=$(this);"180px"==a.css("left")?(a.animate({left:"-0px"},200,function(){a.addClass("open")}),e.animate({overflow:"hidden",left:"-180px"},200),$("body").animate({paddingLeft:"0px"},200),am.writeCookie("leftside",0)):(a.animate({left:"180px"},200,function(){a.removeClass("open")}),e.animate({overflow:"hidden",left:"0px",overflowY:"scroll"},200),$("body").animate({paddingLeft:"180px"},200),am.writeCookie("leftside",1))}),"0"===am.readCookie("leftside")&&(e.css({overflow:"hidden",padding:"10px 0px 50px 0px",left:"-180px"}),$("body").css({paddingLeft:"0"}),t.css("left","0px"),t.addClass("open")),$("#mainnav a").each(function(e){var t=window.location.href,t=t.replace(/(.+?)\.(.+?)\//,"/"),a=$(this).attr("href");a==t&&$(this).addClass("hover")}),$("#mainnav li a").click(function(t){$("#loadingimg").show();var a=e,n=(a.html(),$(this).attr("data-url"));return $.ajax({type:"POST",url:ainiku.getmenu,data:{url:n},success:function(t){$("#loadingimg").hide(),"1"==t.status?e.html(t.info):ank.msg(t.info)}}),!1}),$(".check-all").click(function(e){$(this).is(":checked")?$(".check-item").prop("checked",!0).change():$(".check-item").prop("checked",!1).change()}),$(".popupthumb").hover(function(){var e=$(this),t=e.find("img").length;if(0==t){var a=$(this).find(".imgbox").attr("_src");$(this).find(".wrapimg").append('<img src="'+a+'" width="" height="" />')}var n=e.offset().top,i=$(window).height(),r=$(this).find(".imgbox").height();r>i-n-20&&n>=i-n?$(this).find(".imgbox").css({top:"-"+r+"px"}):$(this).find(".imgbox").css({top:"35px"}),$(this).find(".imgbox").show()},function(){$(this).find(".imgbox").hide()}),$(".klbatch").bind("click",function(){return $(this).addClass("disabled"),obj=$(this),url=obj.attr("href"),idstr="",$("input.check-item:checked").each(function(e,t){""==idstr?idstr=$(this).val():idstr+=","+$(this).val()}),idstr=idstr.replace(/\s+/g,""),""==idstr?(ank.msg("请选择后再操作"),$(this).removeClass("disabled"),!1):confirm("确定要此操作吗?")?($.ajax({type:"GET",url:url,data:{id:idstr},success:function(e){ank.msg(e,function(e){"1"==e.status&&window.location.reload()})},dataType:"JSON"}),!1):!1}),$(".btn-search").click(function(e){$(this).parents("form").submit()}),$(".autosubmit").find("input").keyup(function(e){if(13===e.keyCode){var t=$(this).parents("form").find(".ajax-post");t.length>0?t.click():$(this).parents("form").submit()}}),$("#nav-bar a").each(function(e,t){var a=window.location.pathname,n=$(this).attr("href");a===n&&$(this).parent().addClass("on")}),$("#west").length>0&&this.bindLeftMenu()},bindLeftMenu:function(){if($(".menu .mt a").click(function(e){var t=$(this).find("i");t.hasClass("menuopenico")?(t.removeClass("menuopenico"),t.addClass("menucloseico"),t.parents("dl").find("dd").hide()):($(this).parents("#west").find("i.menuopenico").click(),t.removeClass("menucloseico"),t.addClass("menuopenico"),t.parents("dl").find("dd").show())}),$(".menu .mitem  a").click(function(e){$(".menu .mitem  a").removeClass("hover"),$(this).addClass("hover");var t=$(this).attr("href"),a=$(this).text();return addtabclose(a,t),!1}),$(".menu .mt a").click(),am.hasmenu=!1,$(".menu a").each(function(e,t){var a=window.location.href;a=a.replace(/(.*?)\.(.*?)\//,"/"),a=a.replace("&mainmenu=true","");var n=$(this).attr("href");a==n&&(am.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))}),!am.hasmenu){var e=window.location.href;e=e.replace(/(.*?)\.(.*?)\//,"/"),e=e.replace(".html","");$(".menu a").each(function(t,a){var n=e.split("/"),i=$(this).attr("href");i=i.replace(".html","");var r=i.split("/");n.length>r.length?n=n.slice(0,r.length):r=r.slice(0,n.length),n.join("/")==r.join("/")&&(window.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))})}if(am.hasmenu||$(".menu a").each(function(e,t){var a=document.referrer;a=a.replace(/(.*?)\.(.*?)\//,"/");var n=$(this).attr("href");a===n&&(window.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))}),!am.hasmenu){var t=$(".menu a[href='"+ainiku.defaultmenu+"']");t.length>0?(t.addClass("hover"),t.parents(".menu").find("dt a").click()):$(".menu dt a").eq(0).click()}},bindDel:function(){$(".imgblock  .btn-danger").unbind("click"),$(".imgblock  .btn-danger").click(function(e){var t=$(this).attr("dataid");$.get(ainiku.delimg,{id:t});var a=$(this).parent().parent().prev().val();return""!=a&&(a=a.replace(/\s+/g,""),a=a.replace(t+"|",""),a=a.replace("|"+t,""),a=a.replace(t,""),a=a.replace("||","|"),$(this).parent().parent().prev().val(a),$(this).parent().remove()),!1})},delEditorImg:function(e,t){e===t||$.ajax({type:"POST",url:ainiku.deleditorimg,data:{s:e,d:t}})},bindDelAttach:function(){$(".upload-pre-file .btn-danger").unbind("click"),$(".upload-pre-file .btn-danger").click(function(e){var t=$(this).attr("dataid");$.get(ainiku.delattach,{id:t}),$(this).parent().parent().prev().val(""),$(this).parent().remove()})},setPosition:function(e,t,a,n,i){var r=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(ainiku.setposition,{table:e,id:t,field:a,value:n},function(e){layer.close(r),layer.open({shade:0,title:"修改标记",type:1,content:e.info,area:["330px"],btn:["保存","取消"],yes:function(e,t){var a=$("#positionform");$.ajax({type:"POST",url:a.attr("action"),data:a.serialize(),success:function(e){var t=$(i).children();1==e.status&&(t.eq(0).val(e.info[1]),t.eq(1).html(e.info[0])),ank.msg("操作成功!")}}),layer.close(e)},cancel:function(e,t){layer.close(e)}})})},ajaxForm:function(thisobj,callback){thisobj=$(thisobj),"undefined"!=typeof arguments[2]&&(reloadbool=arguments[2]),"undefined"!=typeof arguments[1]&&(msgtime=arguments[1]);try{"function"==typeof _before_func&&_before_func();var thisobj,obj,a,url;if(a="",formobj=thisobj.parents("form"),!formobj)return!1;formobj.submit(function(e){return!1});var url=formobj.attr("action");postdata=formobj.serialize(),a="{"+a+"}",b=eval("("+a+")");var lindex=parent.layer.load(1,{shade:!1});$.ajax({url:url,type:"POST",datatype:"JSON",data:postdata,success:function(e){parent.layer.close(lindex),ank.msg(e,function(){"function"==typeof _after_func&&_after_func(e),"function"==typeof callback&&callback(e)})}})}catch(e){alert(e.name+": "+e.message)}},ajaxHref:function(e,t){e=$(e),"undefined"!=typeof arguments[2]&&(reloadbool=arguments[2]),"undefined"!=typeof arguments[1]&&(msgtime=arguments[1]),url=e.attr("href"),"undefined"==typeof url&&(url=e.attr("url"));var a=parent.layer.load(1,{shade:!1});return $.ajax({type:"POST",url:url,success:function(e){parent.layer.close(a),ank.msg(e,function(){"function"==typeof _after_func&&_after_func(e),"function"==typeof t&&t(e)})},dataType:"JSON"}),!1},writeCookie:function(e,t,a){var n="";null!=a&&(n=new Date((new Date).getTime()+36e5*a),n="; expires="+n.toGMTString()),document.cookie=e+"="+encodeURI(t)+n},readCookie:function(e){var t="",a=e+"=";return document.cookie.length>0&&(offset=document.cookie.indexOf(a),-1!=offset&&(offset+=a.length,end=document.cookie.indexOf(";",offset),-1==end&&(end=document.cookie.length),t=decodeURI(document.cookie.substring(offset,end)))),t},submitArticle:function(e){var t=$(e).parents("form");t.submit(function(e){return!1});var a=t.attr("action"),n=t.serialize(),i=parent.layer.load(1,{shade:!1});$.ajax({url:a,type:"POST",datatype:"JSON",data:n,success:function(e){parent.layer.close(i),ank.msg(e.info);var t=$('input[name="article_id"]').val();""==t&&$('input[name="article_id"]').val(e.article_id)}})},saveDraftbox:function(e,t){am.draftboxtimeid&&clearInterval(am.draftboxtimeid);var a=e,n=$("#submitbtn"),i=n.html();if(1==a){var r=t,o=r;am.draftboxtimeid=setInterval(function(){var e=$('input[name="status"]:checked').val();$('input[name="article_id"]').val();if("2"==e){var t=$('input[name="title"]').val();""!=t&&($("#submitbtn").html("保存草稿("+o+")"),o--<=0&&(o=r,am.submitArticle()))}else o=r,2!=e?n.html("确定更新"):n.html(i)},1e3)}},updatePwd:function(e){var t=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(e,function(e){ank.open({title:"修改密码",type:1,content:e,area:["300px","350px"]}),layer.close(t)})},modPwd:function(e){var t=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(e,function(e){ank.open({title:"修改密码",type:1,content:e,area:["300px","350px"]}),layer.close(t)})},autoHeight:function(e){var t=$(e);t.height(e.scrollHeight)}},window.rightMenu={currentTab:null,init:function(){$("#youmenu").hover(function(){$("#youmenu").show()},function(){$("#youmenu").hide()}),$(".chrome-tab").bind("contextmenu",function(){rightMenu.currentTab=$(this);try{window.event&&(e=window.event),$("#youmenu").css({left:e.clientX-5,top:e.clientY-5}),$("#youmenu").show()}catch(e){}return!1})},closeTab:function(){this.currentTab&&this.currentTab.find(".close").click(),$("#youmenu").hide()},closeOtherTab:function(){$("#nav-block .chrome-tab").not(".hover").find(".close").click(),$("#youmenu").hide()}},am.init(),rightMenu.init()});