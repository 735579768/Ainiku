$(function(){window.am={version:"1.0",changeVerify:function(){var t=document.getElementById("verifyimg");t&&(t.src=t.src.replace(/\&r=.*/,"")+"&r="+Math.random())},okAction:function(t){layer.confirm("确认此操作?",{btn:["确认","取消"]},function(a){layer.close(a),$.get(t,function(t){ank.msg(t)})},function(){})},init:function(){$(".ajax-post").bind("click",function(){return $("#yzerr").length>0?(ank.msg("请按格式填写!"),!1):void am.ajaxForm($(this))}),$(".ajax-href").bind("click",function(){return am.ajaxHref($(this))}),$(".ajax-href-del").bind("click",function(){var t=$(this);return layer.confirm("确认此操作吗?",{btn:["确认","取消"]},function(a){return layer.close(a),am.ajaxHref(t)}),!1}),$(".ajax-list-del").bind("click",function(){var t=$(this);return layer.confirm("确认此操作吗?",{btn:["确认","取消"]},function(a){layer.close(a);var e=t.attr("href");$.ajax({type:"POST",url:e,success:function(a){"1"==a.status&&t.parent().parent().remove(),ank.msg(a.info)},dataType:"JSON"})}),!1}),$(".ajax-blur").bind("change",function(){var t=$(this).attr("data-id"),a=$(this).attr("data-table"),e=$(this).attr("data-field"),n=$(this).val();$.ajax({type:"POST",url:ainiku.updatefield,data:{id:t,table:a,field:e,value:n},success:function(t){ank.msg(t)}})}),$(".yn").each(function(t,a){$(this).parent().css("text-align","center");var e=parseInt($(this).attr("data-value"));1===e?$(this).addClass("y"):$(this).addClass("n"),$(this).click(function(t){var a=$(this),e=parseInt($(this).attr("data-value")),n=$(this).attr("data-table"),i=$(this).attr("data-field"),r=$(this).attr("data-id"),s=function(){a.hasClass("y")?(a.attr("data-value",0),a.removeClass("y"),a.addClass("n")):(a.attr("data-value",1),a.removeClass("n"),a.addClass("y"))};e=e?0:1,""!==e&&""!==n&&""!==i&&""!==r&&(s(),$.ajax({type:"POST",data:{id:r,table:n,field:i,value:e},url:ainiku.updatefield,success:function(t){ank.msg(t)}}))})}),$(".mainnav li a").click(function(t){$(".mainnav li a").removeClass("hover"),$(this).addClass("hover")}),$(".downmenu").hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()});var t=$("#west"),a=$("#closewest");a.click(function(a){var e=$(this);"180px"==e.css("left")?(e.animate({left:"-0px"},200,function(){e.addClass("open")}),t.animate({overflow:"hidden",left:"-180px"},200),$("body").animate({paddingLeft:"0px"},200),am.writeCookie("leftside",0)):(e.animate({left:"180px"},200,function(){e.removeClass("open")}),t.animate({overflow:"hidden",left:"0px",overflowY:"scroll"},200),$("body").animate({paddingLeft:"180px"},200),am.writeCookie("leftside",1))}),"0"===am.readCookie("leftside")&&(t.css({overflow:"hidden",padding:"10px 0px 50px 0px",left:"-180px"}),$("body").css({paddingLeft:"0"}),a.css("left","0px"),a.addClass("open")),$("#mainnav a").each(function(t){var a=window.location.href,a=a.replace(/(.+?)\.(.+?)\//,"/"),e=$(this).attr("href");e==a&&$(this).addClass("hover")}),$("#mainnav li a").click(function(a){$("#loadingimg").show();var e=t,n=(e.html(),$(this).attr("data-url"));return $.ajax({type:"POST",url:ainiku.getmenu,data:{url:n},success:function(a){$("#loadingimg").hide(),"1"==a.status?t.html(a.info):ank.msg(a.info)}}),!1}),$(".check-all").click(function(t){$(this).is(":checked")?$(".check-item").prop("checked",!0).change():$(".check-item").prop("checked",!1).change()}),$(".popupthumb").hover(function(){var t=$(this),a=t.find("img").length;if(0==a){var e=$(this).find(".imgbox").attr("_src");$(this).find(".wrapimg").append('<img src="'+e+'" width="" height="" />')}var n=t.offset().top,i=$(window).height(),r=$(this).find(".imgbox").height();r>i-n-20&&n>=i-n?$(this).find(".imgbox").css({top:"-"+r+"px"}):$(this).find(".imgbox").css({top:"35px"}),$(this).find(".imgbox").show()},function(){$(this).find(".imgbox").hide()}),$(".klbatch").bind("click",function(){return $(this).addClass("disabled"),obj=$(this),url=obj.attr("href"),idstr="",$("input.check-item:checked").each(function(t,a){""==idstr?idstr=$(this).val():idstr+=","+$(this).val()}),idstr=idstr.replace(/\s+/g,""),""==idstr?(ank.msg("请选择后再操作"),$(this).removeClass("disabled"),!1):confirm("确定要此操作吗?")?($.ajax({type:"GET",url:url,data:{id:idstr},success:function(t){ank.msg(t,function(t){"1"==t.status&&window.location.reload()})},dataType:"JSON"}),!1):!1}),$(".btn-search").click(function(t){$(this).parents("form").submit()}),$(".autosubmit").find("input").keyup(function(t){if(13===t.keyCode){var a=$(this).parents("form").find(".ajax-post");a.length>0?a.click():$(this).parents("form").submit()}}),$("#nav-bar a").each(function(t,a){var e=window.location.pathname,n=$(this).attr("href");e===n&&$(this).parent().addClass("on")}),$("#west").length>0&&this.bindLeftMenu()},bindLeftMenu:function(){if($(".menu .mt a").click(function(t){var a=$(this).find("i");a.hasClass("menuopenico")?(a.removeClass("menuopenico"),a.addClass("menucloseico"),a.parents("dl").find("dd").hide()):($(this).parents("#west").find("i.menuopenico").click(),a.removeClass("menucloseico"),a.addClass("menuopenico"),a.parents("dl").find("dd").show())}),$(".menu .mitem  a").click(function(t){$(".menu .mitem  a").removeClass("hover"),$(this).addClass("hover");var a=$(this).attr("href"),e=$(this).text();return addtabclose(e,a),!1}),$(".menu .mt a").click(),am.hasmenu=!1,$(".menu a").each(function(t,a){var e=window.location.href;e=e.replace(/(.*?)\.(.*?)\//,"/"),e=e.replace("&mainmenu=true","");var n=$(this).attr("href");e==n&&(am.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))}),!am.hasmenu){var t=window.location.href;t=t.replace(/(.*?)\.(.*?)\//,"/"),t=t.replace(".html","");$(".menu a").each(function(a,e){var n=t.split("/"),i=$(this).attr("href");i=i.replace(".html","");var r=i.split("/");n.length>r.length?n=n.slice(0,r.length):r=r.slice(0,n.length),n.join("/")==r.join("/")&&(window.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))})}if(am.hasmenu||$(".menu a").each(function(t,a){var e=document.referrer;e=e.replace(/(.*?)\.(.*?)\//,"/");var n=$(this).attr("href");e===n&&(window.hasmenu=!0,$(this).parents(".menu").find("dt a").click(),$(this).addClass("hover"))}),!am.hasmenu){var a=$(".menu a[href='"+ainiku.defaultmenu+"']");a.length>0?(a.addClass("hover"),a.parents(".menu").find("dt a").click()):$(".menu dt a").eq(0).click()}},bindDel:function(){$(".imgblock  .btn-danger").unbind("click"),$(".imgblock  .btn-danger").click(function(t){var a=$(this).attr("dataid");$.get(ainiku.delimg,{id:a});var e=$(this).parent().parent().prev().val();return""!=e&&(e=e.replace(/\s+/g,""),e=e.replace(a+"|",""),e=e.replace("|"+a,""),e=e.replace(a,""),e=e.replace("||","|"),$(this).parent().parent().prev().val(e),$(this).parent().remove()),!1})},delEditorImg:function(t,a){t===a||$.ajax({type:"POST",url:ainiku.deleditorimg,data:{s:t,d:a}})},bindDelAttach:function(){$(".upload-pre-file .btn-danger").unbind("click"),$(".upload-pre-file .btn-danger").click(function(t){var a=$(this).attr("dataid");$.get(ainiku.delattach,{id:a}),$(this).parent().parent().prev().val(""),$(this).parent().remove()})},setPosition:function(t,a,e,n,i){var r=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(ainiku.setposition,{table:t,id:a,field:e,value:n},function(t){layer.close(r),layer.open({shade:0,title:"修改标记",type:1,content:t.info,area:["330px"],btn:["保存","取消"],yes:function(t,a){var e=$("#positionform");$.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),success:function(t){var a=$(i).children();1==t.status&&(a.eq(0).val(t.info[1]),a.eq(1).html(t.info[0])),ank.msg("操作成功!")}}),layer.close(t)},cancel:function(t,a){layer.close(t)}})})},ajaxForm:function(t,a){return ank.ajaxForm(t,a)},ajaxHref:function(t,a){return ank.ajaxHref(t,a)},writeCookie:function(t,a,e){ank.writeCookie(t,a,e)},readCookie:function(t){return ank.readCookie(t)},submitArticle:function(t){var a=$(t).parents("form");a.submit(function(t){return!1});var e=a.attr("action"),n=a.serialize(),i=parent.layer.load(1,{shade:!1});$.ajax({url:e,type:"POST",datatype:"JSON",data:n,success:function(t){parent.layer.close(i),ank.msg(t.info);var a=$('input[name="article_id"]').val();""==a&&$('input[name="article_id"]').val(t.article_id)}})},saveDraftbox:function(t,a){am.draftboxtimeid&&clearInterval(am.draftboxtimeid);var e=t,n=$("#submitbtn"),i=n.html();if(1==e){var r=a,s=r;am.draftboxtimeid=setInterval(function(){var t=$('input[name="status"]:checked').val();$('input[name="article_id"]').val();if("2"==t){var a=$('input[name="title"]').val();""!=a&&($("#submitbtn").html("保存草稿("+s+")"),s--<=0&&(s=r,am.submitArticle()))}else s=r,2!=t?n.html("确定更新"):n.html(i)},1e3)}},updatePwd:function(t){var a=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(t,function(t){ank.open({title:"修改密码",type:1,content:t,area:["300px","350px"]}),layer.close(a)})},modPwd:function(t){var a=layer.load(1,{time:0,shade:[.1,"#fff"]});$.get(t,function(t){ank.open({title:"修改密码",type:1,content:t,area:["300px","350px"]}),layer.close(a)})},autoHeight:function(t){var a=$(t);a.height(t.scrollHeight)}},window.rightMenu={currentTab:null,init:function(){$("#youmenu").hover(function(){$("#youmenu").show()},function(){$("#youmenu").hide()}),$(".chrome-tab").bind("contextmenu",function(){$("#nav-block .chrome-tab").removeClass("currenttab"),$(this).addClass("currenttab"),rightMenu.currentTab=$(this);try{window.event&&(t=window.event),$("#youmenu").css({left:t.clientX-5,top:t.clientY-5}),$("#youmenu").show()}catch(t){}return!1})},closeTab:function(){this.currentTab&&this.currentTab.find(".close").click(),$("#youmenu").hide()},closeOtherTab:function(){$("#nav-block .chrome-tab").not(".currenttab").find(".close").click(),$("#youmenu").hide()}},am.init(),rightMenu.init()});