<style type="text/css">
.address-edit-box{width:auto;margin:10px;}
.address-edit-box textarea:focus,.address-edit-box input:focus{border-color:#ff6700}
.address-edit-box textarea,.address-edit-box input{display:block;display:block;outline:none;border:solid 1px #e0e0e0;height:30px;line-height:30px;padding:5px 10px;margin-top:10px;width:300px;}
.address-edit-box input:hover{border-color:#b0b0b0;}
.address-edit-box textarea{height:50px;resize:none;line-height:20px;padding:10px;}
.address-edit-box .form-section{position:relative;margin-top:15px;}
.address-edit-box .form-section  label{background:#fff;height:20px;line-height:20px;position:absolute;left:10px;top:9px;color:#bbb;font-size:14px;}
.address-edit-box .address-btn{margin-top:20px;}
.address-edit-box .address-btn .btn{padding:6px 11px;width:130px;color:#fff!important;}
.address-edit-box .address-btn .btn-ok{background:#4bbd00;}
.address-edit-box .address-btn .btn-cancel{background:#C3A200;}
.form-section select{padding:0px 0px 0px 10px;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:solid 1px #e0e0e0;height:38px;line-height:38px;}
#Provinceconsignee_diqu,#cityconsignee_diqu{width:154px;}
#Provinceconsignee_diqu{display:inline-block;}
#cityconsignee_diqu{display:inline-block;margin-left:10px;}
#area1consignee_diqu{margin-top:10px;width:322px;}
#diqu-section{}
#dialog #dialog-con{padding:0px!important;}
</style>
<div class="address-edit-box">
<div class="form-section">
<label class="input-label" >姓名</label>
 <input class="auto-label" name="consignee_name" value="{$info['consignee_name']}" data-msg="收货人姓名" placeholder="姓名">
 </div>

 <div class="form-section">
 <label class="input-label" >手机号</label>
 <input class="auto-label" name="consignee_mobile" value="{$info['consignee_mobile']}" data-msg="常用手机号" placeholder="手机号">
 </div>
 <div class="form-section cl">
               <style>select.selarea{ width:150px; overflow:hidden;}</style>
<div id="diqu-section">
<input type="hidden" id="ssqconsignee_diqu"  name="consignee_diqu"  value="{$info['consignee_diqu']}" />
 <select id="Provinceconsignee_diqu" class="selarea"><option value="0">请选择--</option></select>
<select id="cityconsignee_diqu" class="selarea"><option value="0">请选择--</option></select>
<select id="area1consignee_diqu" class="selarea"><option value="0">请选择--</option></select>
<select id="area11consignee_diqu" class="selarea" style="display:none;"><option value="0">请选择--</option></select>
</div>
<script>
(function(){
    var arr = $('#ssqconsignee_diqu').val();
    arr = arr.split(',');
    $.ajax({
        type: 'post',
        url: "{:U('Region/index')}",
        data: {
            id: 0,
            selid: arr[0]
        },
        success: function(da) {
            $('#Provinceconsignee_diqu').html(da);
            if ($('#Provinceconsignee_diqu').val() != 0) {
                $('#Provinceconsignee_diqu').change();
            }
            setssqconsignee_diqu();
        }
    });
    $('#Provinceconsignee_diqu').change(function(e) {
        var idd = $(this).val();
        if (idd != 0) {
            $.ajax({
                type: 'post',
                url: "{:U('Region/index')}",
                data: {
                    id: idd,
                    selid: arr[1]
                },
                success: function(da) {
                    $('#cityconsignee_diqu').html(da);
                    $('#cityconsignee_diqu').change();
                    setssqconsignee_diqu();
                }
            });
        } else {
            $('#cityconsignee_diqu').html('<option value="0">请选择--</option></select>');
            $('#cityconsignee_diqu').change();
            setssqconsignee_diqu();
        }
    });

    $('#cityconsignee_diqu').change(function(e) {
        var idd = $(this).val();
        if (idd != 0) {
            $.ajax({
                type: 'post',
                url: "{:U('Region/index')}",
                data: {
                    id: idd,
                    selid: arr[2]
                },
                success: function(da) {
                    $('#area1consignee_diqu').html(da);
                    $('#area1consignee_diqu').change();
                    setssqconsignee_diqu();
                }
            });
        } else {
            $('#area1consignee_diqu').html('<option value="0">请选择--</option></select>');
            $('#area1consignee_diqu').change();
            setssqconsignee_diqu();
        }
    });
    $('#area1consignee_diqu').change(function(e) {
        var idd = $(this).val();
        if (idd != 0) {
            $.ajax({
                type: 'post',
                url: "{:U('Region/index')}",
                data: {
                    id: idd,
                    selid: arr[3]
                },
                success: function(da) {
                    $('#area11consignee_diqu').html(da);
                    $('#area11consignee_diqu').change();
                    setssqconsignee_diqu();
                }
            });
        } else {
            $('#area11consignee_diqu').html('<option value="0">请选择--</option></select>');
            $('#area11consignee_diqu').change();
            setssqconsignee_diqu();
        }
    });
    $('#area11consignee_diqu').change(function(e) {
        setssqconsignee_diqu();
    });

    window.setssqconsignee_diqu = function() {
        var idd = 'consignee_diqu';
        var str1 = $('#Province' + idd).val();
        var str2 = $('#city' + idd).val();
        var str3 = $('#area1' + idd).val();
        var str4 = $('#area11' + idd).val();
        $('#ssq' + idd).val(str1 + ',' + str2 + ',' + str3 + ',' + str4);
    }
})();
</script> 
 </div>
 <div class="form-section">
 <label class="input-label">详细地址</label>
 <textarea class="auto-label" name="consignee_detail" data-msg="详细地址，路名或街道名称，门牌号"  placeholder="详细地址">{$info['consignee_detail']}</textarea>
 </div>

 <div class="form-section">
 <label class="input-label">邮政编码</label>
 <input class="auto-label" name="consignee_youbian" value="{$info['consignee_youbian']}" data-msg="邮政编码" placeholder="邮政编码">
 </div>
 <div class="address-btn">
 <input type="hidden" name="consignee_address_id" value="{$info['consignee_address_id']}" />
     <a href="javascript:;" id="btn-save" onclick="saveAddress();" class="btn btn-ok">保存</a>
     <a href="javascript:;" id="btn-cancel" onclick="cancelAddress();" class="btn btn-cancel">取消</a>
 </div>
</div>
<script type="text/javascript">
$('.auto-label').focus(function(event) {
    var _this = $(this);
    var labobj = _this.prev();
    var ms = _this.attr('data-msg');
    _this.css('borderColor', '#ff6700');
    labobj.css('color', '#ff6700');
    //if (_this.val() == '') {
    labobj.show();
    _this.attr('placeholder', '');
    labobj.animate({
            top: -9,
            fontSize: 12
        },
        300,
        function() {
            _this.attr('placeholder', ms);
        });
    //}
});
$('.auto-label').blur(function(event) {
    var _this = $(this);
    var labobj = _this.prev();
    var ms = _this.attr('data-msg');
    _this.css('borderColor', '#e0e0e0');
    labobj.css('color', '#bbb');
    if (_this.val() == '') {
        _this.attr('placeholder', '');
        labobj.animate({
                top: 9,
                fontSize: 14
            },
            300,
            function() {
                _this.attr('placeholder', labobj.html());
            });
    }


});

$('.form-section .auto-label').each(function(index) {
    var str = $(this).val();
    if (str != '') {
        var _this = $(this);
        var labobj = _this.prev();
        var ms = _this.attr('data-msg');
        labobj.css({
            color: '#bbb',
            top: -9,
            fontSize: 12
        });
        _this.attr('placeholder', ms);
        labobj.show();
        _this.attr('placeholder', '');
    }

});
window.saveAddress=function(){
    var name=$("input[name='consignee_name']").val();
    var mobile=$("input[name='consignee_mobile']").val();
    var diqu=$("input[name='consignee_diqu']").val();
    var detail=$("textarea[name='consignee_detail']").val();
    var youbian=$("input[name='consignee_youbian']").val();
    var addressid=$("input[name='consignee_address_id']").val();
    if(name==''||mobile==''||diqu==''||detail==''||youbian==''){ank.msg('请填写信息!');return false;}
    $.ajax({
        type:'POST',
        url:"{:U('Buy/addaddress')}",
        data:{
            consignee_name:name,
            consignee_mobile:mobile,
            consignee_diqu:diqu,
            consignee_detail:detail,
            consignee_youbian:youbian,
            consignee_address_id:addressid
        },
        success:function(da){
            if(da.status==1){
                if(da.action=='add'){
                    //添加地址块信息
                    var shtml='<dl onclick="selectedAddress(this);" id="consignee_address{consignee_address_id}" class="s-adr cl"><dt>{consignee_name}</dt><dd><div class="s-mobile">{consignee_mobile}</div><div class="s-diqu">{consignee_diqu}</div></dd><dd class="action"><a onclick="modAddress({consignee_address_id})" data-id="{consignee_address_id}" href="javascript:;">修改</a></dd></dl>';
                    shtml=shtml.replace(/\{consignee_address_id\}/g,da.data.address_id);
                    shtml=shtml.replace(/\{consignee_name\}/g,da.data.name);
                    shtml=shtml.replace(/\{consignee_diqu\}/g,da.data.diqu);
                    shtml=shtml.replace(/\{consignee_mobile\}/g,da.data.mobile);
                    $('#add-new-address').parent().before(shtml);
                    $('#consignee_address'+da.data.address_id).click();
                }else{
                    //修改地址块信息
                    var o=$('#consignee_address'+da.data.address_id);
                    o.find('dt').html(da.data.name);
                    o.find('.s-mobile').html(da.data.mobile);
                    o.find('.s-diqu').html(da.data.diqu);    
                }
                $('#dialog-wrap').remove();
            }else{
                ank.msg(da.info);
            }
        }
    });

};
window.cancelAddress=function(){
    $('#dialog-wrap').remove();
};
</script>