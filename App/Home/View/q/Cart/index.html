<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
<ank:insert name="reset,common,index" />
<ank:insert name="jquery-1.9.1.min,ainiku,functions,ajax,jquery.SuperSlide.2.1.1" type="js"  />
</head>

<body>
<style>
.cart-list-box{font-size:14px;margin:0px auto;width:1100px;}
.cart-list-box .list-body{border-top:solid 1px #ccc;}
.cart-list-box .list-body .col{height:90px;line-height:90px;}
.cart-list-box .row{width:100%;display:block;background:#fff;}
.cart-list-box .col{height:70px;line-height:70px;display:block;float:left;text-align:center;}
.cart-list-box .col-check{width:100px; text-align:left;}
.cart-list-box .col-check .icon-check{ margin-left:40px;}
.cart-list-box .col-img{width:120px;}
.cart-list-box .col-img img{width:80px;height:80px;margin-top:5px;}
.cart-list-box .col-title{width:300px;text-align:left; }
.cart-list-box .col-price{width:150px;}
.cart-list-box .col-num{width:150px;}
.cart-list-box .cart-num,.cart-list-box .cart-num .input-num,.cart-list-box .cart-num span{height:40px;line-height:40px;float:left;}
.cart-list-box .cart-num{border:solid 1px #E0E0E0;width:150px;margin-top:19px;}
.cart-list-box .cart-num span{cursor:pointer;font-size:25px;display:inline-block;width:40px;}
.cart-list-box .cart-num span:hover{background-color:#e0e0e0;}
.cart-list-box .cart-num .input-num{text-align:center;vertical-align:top;border:none;width:70px;display:inline-block;}
.cart-list-box .col-total{width:150px;}
.cart-list-box .col-action{ width:130px;}
.cart-list-box .list-body .col-price,.cart-list-box .list-body .col-total{color:#ff6700;}
.cart-list-box .cart-bar{background:#fff;margin-top:20px;height:50px;line-height:50px;}
.cart-list-box .cart-bar .section-left{float:left;}
.cart-list-box .cart-bar .section-right{float:right;}
.cart-list-box .cart-bar .totalprice{color:#ff6700;}
.cart-list-box .cart-bar .totalprice .price{font-size:30px;}
.cart-list-box .cart-bar .a-btn{display:inline-block;color:#fff;text-align:center;padding:0px;background:#5cb85c;height:48px;line-height:48px;font-size:18px;vertical-align:top;}
.cart-list-box .cart-bar .l-btn{width:150px;background:none;color:#666;}
.cart-list-box .cart-bar .r-btn{width:200px;margin-left:50px;}

</style>
<div class="cart-list-box cl">
 <ul class="row list-head cl">
 	<li class="col col-check"><div id="all-selected" class="icon-check"><a href="javascript:;"></a></div>
    &nbsp;全选</li>
    <li class="col col-img"></li>
    <li class="col col-title">商品名称</li>
    <li class="col col-price">单价</li>
    <li class="col col-num">数量</li>
    <li class="col col-total">小计</li>
    <li class="col col-action">操作</li>
 </ul>
 <volist name="_list" id="vo">
 <ul class="row list-body cl">
 	<li class="col col-check">
    <div class="icon-check check-item" data-id="{$vo.cart_id}"><a href="javascript:;"></a></div>
    </li>
    <li class="col col-img"><img src="{$vo.pic|getPicture='thumbpath','80_80'}" /></li>
    <li class="col col-title">{$vo.title}</li>
    <li class="col col-price">{$vo.price}元</li>
    <li class="col col-num">
   	  <div class="cart-num">
        <span class="jian">-</span>
        <input class="input-num" autocomplete="off" name="num" value="{$vo.num}" />
        <span class="jia">+</span>
        </div>
    </li>
    <li class="col col-total">{$vo['price']*$vo['num']}元</li>
    <li class="col col-action">
    <a class="delcartgoods" href="javascript:;">删除</a></li>
 </ul>
 </volist>
 <div class="cart-bar cl">
 <div class="section-left">
 	<a href="javascript:;" class="a-btn l-btn">继续购物</a>
 </div>
 <div class="section-right">
 <span class="totalprice">合计（不含运费）：<em id="totalprice" class="price"></em>元 </span>
 <a href="javascript:;" class="a-btn r-btn">去结算</a>
 </div>
 </div>
</div>
<script>
$(function() {
    //全部选中或取消
    $('#all-selected').click(function(event) {
        var _this = $(this);
        var _li = $('.check-item');
        var ha = _this.hasClass('icon-check-selected');
        if (ha) {
            _this.removeClass('icon-check-selected');
            _li.removeClass('icon-check-selected');
        } else {
            _this.addClass('icon-check-selected');
            _li.addClass('icon-check-selected');
        }
    });
    $('.check-item').click(function(event) {
        var _this = $(this);
        var ha = _this.hasClass('icon-check-selected');
        ha ? _this.removeClass('icon-check-selected') : _this.addClass('icon-check-selected');
    });
    //加减数量
    $('.jia').click(function(e) {
        var _this = $(this);
        var v = parseInt(_this.prev().val());
        _this.prev().val(v + 1);
        //更新小计
        var v = parseInt(_this.prev().val());
        var pa = _this.parents('.col');
        var pr = parseFloat(pa.prev().html());
        pa.next().html((v * pr).toFixed(1) + '元');
        //更新总价
        cartobj.updateTotalPrice();
        //更新数量
        var cartid = _this.parents('.list-body').find('.icon-check').attr('data-id');
        cartobj.updateGoodsNum(cartid, v);
    });
    $('.jian').click(function(e) {
        var _this = $(this);
        var v = parseInt(_this.next().val());
        if ((v - 1) > 0) {
            _this.next().val(parseInt(v - 1));
        } else {
            _this.next().val(1);
        }
        //更新小计
        var v = parseInt(_this.next().val());
        var pa = _this.parents('.col');
        var pr = parseFloat(pa.prev().html());
        pa.next().html((v * pr).toFixed(1) + '元');
        //更新总价
        cartobj.updateTotalPrice();
        //更新数量
        var cartid = _this.parents('.list-body').find('.icon-check').attr('data-id');
        cartobj.updateGoodsNum(cartid, v);
    });
    //数量改变
    $('.input-num').bind('change', function(event) {
        var _this = $(this);
        var t = _this.val();
        if (t < 1) _this.val(1);
    });
    window.cartobj = {
        //更新产品数量
        updateGoodsNum: function(cartid, numb) {
            $.ajax({
                type: 'POST',
                url: "{:U('Cart/updatenum')}",
                data: {
                    cart_id: cartid,
                    num: numb
                },
                success: function(da) {
                    if (da.status == 0) {
                        alert('error');
                    }
                }
            });
        },
        //更新购物车总价
        updateTotalPrice: function() {
            var t = 0;
            $('.list-body .col-total').each(function(index) {
                t += parseFloat($(this).html());
            });
            $('#totalprice').html(t);
        },
        //删除购物车产品
        delCartGoods: function(cartid) {
            $.ajax({
                type: 'POST',
                url: "{:U('Cart/del')}",
                data: {
                    cart_id: cartid
                },
                success: function(da) {
                    if (da.status == 0) {
                        alert('error');
                    } else {
                        $('.list-body .icon-check[data-id=' + cartid + ']').parents('.list-body').remove();
                    }
                }
            });
        }
    };

    window.addToCart=function(){
        var arg=arguments;
        if(!(arg[0] && arg[1])){alert('参数不能为空!');return false;}
        var goodsid=arg[0];
        var numb=arg[1];
        var callback=arg[2];
        $.ajax({
            type:'POST',
            url:"{:U('Cart/add')}",
            data:{goods_id:goodsid,num:numb},
            success:function(da){
                if(da.status==1){
                    ank.msg('添加成功');
                }else{
                    ank.msg('添加失败');
                }
                da.goods_id=goodsid;
                da.goods_num=numb;
                (typeof(callback) === 'function')&&callback(da);
            }
        });
    };

    //绑定删除购物车产品按钮
    $('.delcartgoods').click(function(event) {
        var cartid = $(this).parents('.list-body').find('.icon-check').attr('data-id');
        cartobj.delCartGoods(cartid);
        return false;
    });
    //初始化总价
    cartobj.updateTotalPrice();
});
</script>
</body>
</html>
